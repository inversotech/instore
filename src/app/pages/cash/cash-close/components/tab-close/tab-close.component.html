<!-- <nb-card status="basic" class="mb-0">
  <nb-card-header class="lh-base">
    <div class="text-center">
      <span i18n class="">
        CIERRE DE CAJA
      </span>
    </div>
    <div class="text-center">
      <span class="font-weight-light fw-light" i18n>
        En este apartado podrá cerrar las cajas en efectivo, transferencias bancarias, depósitos bancarios etc.
      </span>
    </div>
  </nb-card-header>
  <nb-card-body class="p-0"> -->

<nb-card status="basic" class="mb-1">
  <nb-card-header class="lh-base">
    <div class="text-center">
      <span i18n class="text-primary">
        GESTIONAR CAJAS
      </span>
    </div>
    <div class="text-center">
      <span class="font-weight-light fw-light" i18n>
        En este apartado podrá gestionar las cajas, transferencias bancarias, depósitos bancarios etc.
      </span>
    </div>
  </nb-card-header>
</nb-card>
<div class="row g-1" [nbSpinner]="loading" nbSpinnerStatus="primary">
  <div class="col-md-4 gap-1">
    <nb-card class="mb-0">
      <nb-card-body>
        <form [formGroup]="filterForm">
          <div class="">
            <label for="id_anho" class="label">Año</label>
            <nb-select placeholder="Seleccione" fullWidth size="small" formControlName="id_anho">
              <nb-option value="" disabled> -Seleccionar- </nb-option>
              <nb-option *ngFor="let item of anhos" [value]="item.id_anho">{{ item.id_anho }}</nb-option>
            </nb-select>
          </div>
          <div class="">
            <label for="id_mes" class="label">Mes</label>
            <div>
              <nb-select placeholder="Seleccione" fullWidth size="small" formControlName="id_mes">
                <nb-option value="" disabled> -Seleccionar- </nb-option>
                <nb-option *ngFor="let item of meses" [value]="item.id_mes">{{ item.nombre }}</nb-option>
              </nb-select>
            </div>
          </div>

          <div class="col-auto mt-2 mb-2 text-center">
            <div>
              <button nbButton fullWidth type="button" size="small" class="me-1" (click)="getCajaHabilitadas()">
                <nb-icon nbPrefix icon="search-outline" status="info" pack="eva"></nb-icon>
                Filtrar
              </button>
            </div>
          </div>

          <!-- // Aqui listar las cajas habilitadas pero en lista -->
          <label class="label mb-2">Seleccione una de las cajas</label>

          <nb-list>
            <nb-list-item *ngFor="let item of misCajasHabilitadas" (click)="onBuscar(item)"
              [class.active]="filterForm.get('id_caja')?.value === item.id_caja" class="caja-item position-relative">
              <div class="info">
                <div class="nombre">
                  <strong>
                    <!-- ({{ item.correlativo }})  -->
                    {{ item.caja_nombre }}</strong>
                </div>
                <!-- Fecha -->
                <div class="detalle text-muted d-flex align-items-center">
                  <nb-icon icon="calendar-outline" pack="eva" class="me-1 fs-6"></nb-icon>
                  {{ item.fecha_apertura | date: 'dd/MM/yyyy' }}
                </div>
                <!-- Responsable -->
                <div class="responsable text-muted d-flex align-items-center">
                  <nb-icon icon="person-outline" pack="eva" class="me-1 fs-6"></nb-icon>
                  {{ item.responsable_nombre ?? 'Sin asignar' }}
                </div>
              </div>
              <nb-badge [text]="item.fecha_cierre ? 'Cerrado' : 'Abierto'" 
                [status]="item.fecha_cierre ? 'danger' : 'success'" position="top right">
              </nb-badge>
            </nb-list-item>
          </nb-list>
          <!-- <div class="">
            <label for="id_caja" class="label">Cajas en general</label>
            <div>
              <nb-select placeholder="Seleccione" fullWidth size="small" formControlName="id_caja">
                <nb-option value="-1"> Todos </nb-option>
                <nb-option *ngFor="let item of misCajasHabilitadas" [value]="item.id_caja">
                  ({{ item.correlativo }})-{{ item.caja_nombre }} {{ item.fecha_apertura | date: 'dd/MM/yyyy' }}
                  <span *ngIf="item.fecha_cierre" class="text-danger">&nbsp;Cerrado</span>
                  <span *ngIf="!item.fecha_cierre" class="text-success">&nbsp;Abierto</span>
                </nb-option>
              </nb-select>
            </div>
          </div> -->



        </form>
        <!-- <div class="d-flex align-items-center mb-2">
          <nb-checkbox [checked]="allPagosChecked" (checkedChange)="toggleCheckedAll($event)">
            Seleccionar todos
          </nb-checkbox>
        </div> -->



        <ng-template #templateRefActions let-data class="dlp">
          <nb-card class="mb-0">
            <nb-card-header class="text-center">Acciones</nb-card-header>
            <nb-list>
              <!--                 <nb-list-item>
                        <button *ngIf="saleDetail.id_venta && saleDetail.activo == 'S'  && acctions.canAnular "
                                nbButton fullWidth class="align-content-between" size="tiny"
                                (click)="onActionProcess({codigo:'REFUSE'},saleDetail)"
                                i18n-nbTooltip nbTooltip="Anular">
                          <nb-icon icon="file-outline"></nb-icon>
                          Anular
                        </button>
                      </nb-list-item> -->
              <!-- <nb-list-item *ngIf="data.estado == 1">
            <button nbButton fullWidth class=" align-content-between" size="tiny"
              (click)="onActionProcess({codigo:'SEATS'},data)" i18n-nbTooltip nbTooltip="Regenerar asientos">
              <nb-icon icon="file-outline"></nb-icon>
              Regenerar asientos (Regularizar movimientos)
            </button>
          </nb-list-item> -->

              <!--                       <nb-list-item *ngIf="data.estado == 1">
                        <button *ngIf="data.id_venta && (data.activo == 'S' || data.activo == '1')"
                                nbButton fullWidth class="align-content-between" size="tiny"
                                (click)="onActionProcess({codigo:'GUIA'},data)"
                                i18n-nbTooltip nbTooltip="Emitir Guía de Remisión Remitente">
                          <nb-icon icon="file-outline"></nb-icon>
                          GUIA DE REMISIÓN
                        </button>
                      </nb-list-item> -->

              <nb-list-item *ngIf="data.estado == 1">
                <button nbButton status="danger" fullWidth size="tiny" (click)="anularDeposito(data)"
                  nbTooltip="Anular">
                  <nb-icon icon="file-outline"></nb-icon>
                  Anular
                </button>
              </nb-list-item>

              <!-- <nb-list-item *ngFor="let doc of data.outputDocuments">
            <button [nbSpinner]="doc.loading" nbSpinnerSize="tiny" nbSpinnerStatus="primary" nbButton fullWidth
              size="tiny" (click)="onActionProcess(doc,data)" i18n [nbTooltip]="doc.nombre">
              <nb-icon [icon]="doc.icon || 'file-outline'"></nb-icon>
              {{doc.nombre}}
            </button>
          </nb-list-item> -->
            </nb-list>
          </nb-card>
        </ng-template>


      </nb-card-body>
    </nb-card>
  </div>


  <div class="col-md-8 gap-1" *ngIf="depositos.length>0; else emptyList" [nbSpinner]="loadingDepositos"
    nbSpinnerStatus="primary">
    <nb-card class="mb-0">
      <nb-card-body>

        <div class="text-center d-flex justify-content-between mb-2 position-relative">
          <label class="label">Lista de depositos</label>
          <nb-badge *ngIf="hasCajaCerrada" text="Caja Cerrada" status="danger" position="top right">
          </nb-badge>

          <button *ngIf="!hasCajaCerrada" nbButton type="button" status="info" size="tiny" (click)="onNewCierre()">
            <nb-icon nbPrefix icon="plus-outline" pack="eva"></nb-icon>
            Cerrar caja seleccionada
          </button>
        </div>
        <div class="table-responsive">
          <table class="table table-sm tabla-bordered table-hover">
            <thead>
              <tr></tr>
              <tr>
                <!-- <th class="text-nowrap">N°</th> -->
                <!-- <th class="text-nowrap">USUARIO</th>
                <th class="text-nowrap" colspan="2">MEDIO</th> -->
                <th class="text-nowrap">FECHA</th>
                <th class="text-nowrap">TIPO</th>
                <th class="text-nowrap">SERIE</th>
                <th class="text-nowrap">NÚMERO</th>
                <th class="text-nowrap">GLOSA</th>
                <th class="text-nowrap text-end">IMPORTE</th>
                <th class="text-nowrap text-end">IMPORTE ME</th>
                <th class="text-nowrap text-center">ESTADO</th>
                <!-- <th class="text-nowrap text-center">ACCIONES</th> -->
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let item of depositos | paginate: { id: 'fmrPaginate',
                itemsPerPage: paginate?.pageSize,
                currentPage: paginate?.currentPage,
                totalItems: paginate?.totalItems}; let i=index">
                <tr style="border-width: 1px 0;">
                  <!-- <td class="text-nowrap text-start">{{ item.rn }}</td> -->
                  <!-- <td class="text-nowrap text-start">
                    <nb-checkbox [checked]="item.checked" (checkedChange)="toggleChecked($event, item)"></nb-checkbox>
                  </td> -->
                  <!-- <td class="text-nowrap text-start">{{ item.user_created_email }}</td>
                  <td class="text-nowrap text-start fw-bold">{{ item.mp_alias }}</td>
                  <td class="text-nowrap text-start"></td> -->
                  <td class="text-nowrap text-start">{{ item.fecha_registro | date : 'dd/MM/yyyy HH:mm' }}</td>
                  <td class="text-nowrap text-start">{{ item.id_tipo_comprobante }}</td>
                  <td class="text-nowrap text-start">{{ item.serie }}</td>
                  <td class="text-nowrap text-start">{{ item.numero }}</td>
                  <td class="text-nowrap text-start">
                    <span *ngIf="item.numero_operacion" class="text-capitalize">Ope.{{ item.numero_operacion }}.{{
                      item.fecha_operacion | date : 'dd/MM/yyyy'}}-</span>
                    {{ item.detalle }}
                  </td>
                  <!-- <td class="text-nowrap text-start">{{ item.id_tipo_documento_cli }}</td>
                  <td class="text-nowrap text-start">{{ item.num_doc_cli }}</td> -->
                  <!-- <td class="text-nowrap text-start">{{ item.cliente_nombres_completo }}</td> -->
                  <td class="text-nowrap text-end">{{ item.importe | number : '1.2-2' }}</td>
                  <td class="text-nowrap text-end">{{ item.importe_me | number : '1.2-2' }}</td>
                  <td class="text-nowrap text-center align-middle">
                    <nb-tag size="tiny" [text]="item.estado_descripcion" [status]="tagEstado(item)" class="paso-estado"
                      [nbTooltip]="item.estado_descripcion"></nb-tag>
                  </td>
                  <!-- <td class="text-nowrap text-center align-middle">
                    <button nbButton size="tiny" status="primary" class="ml-1 me-1" [nbPopover]="templateRefActions"
                      nbPopoverPlacement="left" [nbPopoverContext]="item" *ngIf="item.id_deposito">
                      <nb-icon icon="more-vertical-outline" nbTooltip="Mas acciones" nbTooltipStatus="primary">
                      </nb-icon>
                      Más
                    </button>
                  </td> -->
                </tr>
              </ng-container>
            </tbody>
            <tfoot *ngIf="depositos.length>0">
              <tr>
                <th colspan="5" class="text-end">
                  <span class="me-4">TOTALES</span>
                  Cantidad: {{ depositos_total.cantidad_depositos }}
                </th>
                <th class="text-end">
                  {{ depositos_total.total_importe | number : '1.2-2' }}
                </th>
                <th class="text-end">
                  {{ depositos_total.total_importe_me | number : '1.2-2' }}
                </th>
                <th colspan="3"></th>
              </tr>
            </tfoot>

          </table>
        </div>
        <div class="row">
          <div class="col-12">
            <pagination-controls class="lamb-pagination" id="fmrPaginate" (pageChange)="pageChanged($event)"
              (pageBoundsCorrection)="pageChanged($event)" [maxSize]="paginationControls.maxSize"
              [directionLinks]="paginationControls.directionLinks" [responsive]="paginationControls.responsive"
              previousLabel="ANTERIOR" nextLabel="SIGUIENTE" [autoHide]="paginationControls.autoHide"
              screenReaderPaginationLabel="Pagination" screenReaderPageLabel="page"
              screenReaderCurrentLabel="Estás en la página">
            </pagination-controls>
          </div>
        </div>

      </nb-card-body>
    </nb-card>
  </div>
  <ng-template #emptyList>
    <div class="col-md-8">
      <nb-card class="mb-0">
        <nb-card-body>
          <div class="d-flex justify-content-center mt-4">
            <nb-card class="text-center" style="max-width: 350px;">
              <nb-card-body>
                <nb-icon icon="alert-circle-outline" pack="eva" class="mb-2"
                  style="font-size: 2rem; opacity: 0.6;"></nb-icon>
                <p class="fw-bold mb-1">No se encontraron depósitos</p>
                <small class="text-muted">Seleccione una caja para visualizar los registros.</small>
              </nb-card-body>
            </nb-card>
          </div>
        </nb-card-body>
      </nb-card>
    </div>
  </ng-template>
</div>

<!-- </nb-card-body>
</nb-card> -->